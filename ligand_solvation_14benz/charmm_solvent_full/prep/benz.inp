* CHARMM input file for Multi-Site lambda-dynamics
* generated by py_prep (JZV 02/2019) for ALF (RLH 01/2019)
*
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Multi-Site Lambda Dynamics 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

set fnex = 5.5 
!!set sysname = benz
set builddir = prep
set box = 35.058000
set ligseg = lig
set resnum = 1

bomblev -2

! !! Read in toppar stream file
! stream @builddir/toppar.str

open read card unit 10 name @builddir/core.rtf
read rtf card unit 10

open read card unit 20 name @builddir/full_ligand.prm
read para card unit 20 flex

!! !! Reads coordinates and pdb file for the protein
!! read sequ pdb name @builddir/protein.pdb
!! generate SEGID first NTER last CTER setup warn
!! read coor pdb resid name @builddir/protein.pdb
!! 
!! ic generate
!! ic param
!! ic build 
!! hbuild sele hydrogen end
!! auto angle dihe

!! Reads coordinates and pdb file for the ligand
read sequ pdb name @builddir/core.pdb
generate @ligseg setup
read coor pdb resid name @builddir/core.pdb

!! Read in the ligand patch rtf files
read rtf append card name @builddir/site1_sub1_pres.rtf
read rtf append card name @builddir/site1_sub2_pres.rtf
read rtf append card name @builddir/site1_sub3_pres.rtf
read rtf append card name @builddir/site1_sub4_pres.rtf
read rtf append card name @builddir/site1_sub5_pres.rtf
read rtf append card name @builddir/site1_sub6_pres.rtf
read rtf append card name @builddir/site1_sub7_pres.rtf
read rtf append card name @builddir/site1_sub8_pres.rtf
! read rtf append card name @builddir/site1_sub9_pres.rtf
! read rtf append card name @builddir/site1_sub10_pres.rtf
! read rtf append card name @builddir/site1_sub11_pres.rtf
! read rtf append card name @builddir/site1_sub12_pres.rtf
! read rtf append card name @builddir/site1_sub13_pres.rtf
! read rtf append card name @builddir/site1_sub14_pres.rtf
! read rtf append card name @builddir/site1_sub15_pres.rtf
! read rtf append card name @builddir/site1_sub16_pres.rtf
! read rtf append card name @builddir/site1_sub17_pres.rtf
! read rtf append card name @builddir/site1_sub18_pres.rtf
! read rtf append card name @builddir/site1_sub19_pres.rtf
! read rtf append card name @builddir/site1_sub20_pres.rtf
! read rtf append card name @builddir/site1_sub21_pres.rtf
! read rtf append card name @builddir/site1_sub22_pres.rtf
! read rtf append card name @builddir/site1_sub23_pres.rtf
! read rtf append card name @builddir/site1_sub24_pres.rtf
read rtf append card name @builddir/site2_sub1_pres.rtf
read rtf append card name @builddir/site2_sub2_pres.rtf
read rtf append card name @builddir/site2_sub3_pres.rtf
read rtf append card name @builddir/site2_sub4_pres.rtf
read rtf append card name @builddir/site2_sub5_pres.rtf
read rtf append card name @builddir/site2_sub6_pres.rtf
read rtf append card name @builddir/site2_sub7_pres.rtf
read rtf append card name @builddir/site2_sub8_pres.rtf
! read rtf append card name @builddir/site2_sub9_pres.rtf
! read rtf append card name @builddir/site2_sub10_pres.rtf
! read rtf append card name @builddir/site2_sub11_pres.rtf
! read rtf append card name @builddir/site2_sub12_pres.rtf
! read rtf append card name @builddir/site2_sub13_pres.rtf
! read rtf append card name @builddir/site2_sub14_pres.rtf
! read rtf append card name @builddir/site2_sub15_pres.rtf
! read rtf append card name @builddir/site2_sub16_pres.rtf
! read rtf append card name @builddir/site2_sub17_pres.rtf
! read rtf append card name @builddir/site2_sub18_pres.rtf
! read rtf append card name @builddir/site2_sub19_pres.rtf
! read rtf append card name @builddir/site2_sub20_pres.rtf
! read rtf append card name @builddir/site2_sub21_pres.rtf
! read rtf append card name @builddir/site2_sub22_pres.rtf
! read rtf append card name @builddir/site2_sub23_pres.rtf
! read rtf append card name @builddir/site2_sub24_pres.rtf

!! Read in the ligand fragment pdb files
ic generate

patch p1_1 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub1_frag.pdb
ic param
ic build

patch p1_2 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub2_frag.pdb
ic param
ic build

patch p1_3 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub3_frag.pdb
ic param
ic build

patch p1_4 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub4_frag.pdb
ic param
ic build

patch p1_5 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub5_frag.pdb
ic param
ic build

patch p1_6 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub6_frag.pdb
ic param
ic build

patch p1_7 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub7_frag.pdb
ic param
ic build

patch p1_8 @ligseg @resnum setup
read coor pdb resid name @builddir/site1_sub8_frag.pdb
ic param
ic build

! patch p1_9 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub9_frag.pdb
! ic param
! ic build

! patch p1_10 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub10_frag.pdb
! ic param
! ic build

! patch p1_11 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub11_frag.pdb
! ic param
! ic build

! patch p1_12 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub12_frag.pdb
! ic param
! ic build

! patch p1_13 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub13_frag.pdb
! ic param
! ic build

! patch p1_14 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub14_frag.pdb
! ic param
! ic build

! patch p1_15 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub15_frag.pdb
! ic param
! ic build

! patch p1_16 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub16_frag.pdb
! ic param
! ic build

! patch p1_17 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub17_frag.pdb
! ic param
! ic build

! patch p1_18 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub18_frag.pdb
! ic param
! ic build

! patch p1_19 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub19_frag.pdb
! ic param
! ic build

! patch p1_20 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub20_frag.pdb
! ic param
! ic build

! patch p1_21 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub21_frag.pdb
! ic param
! ic build

! patch p1_22 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub22_frag.pdb
! ic param
! ic build

! patch p1_23 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub23_frag.pdb
! ic param
! ic build

! patch p1_24 @ligseg @resnum setup
! read coor pdb resid name @builddir/site1_sub24_frag.pdb
! ic param
! ic build

patch p2_1 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub1_frag.pdb
ic param
ic build

patch p2_2 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub2_frag.pdb
ic param
ic build

patch p2_3 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub3_frag.pdb
ic param
ic build

patch p2_4 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub4_frag.pdb
ic param
ic build

patch p2_5 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub5_frag.pdb
ic param
ic build

patch p2_6 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub6_frag.pdb
ic param
ic build

patch p2_7 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub7_frag.pdb
ic param
ic build

patch p2_8 @ligseg @resnum setup
read coor pdb resid name @builddir/site2_sub8_frag.pdb
ic param
ic build

! patch p2_9 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub9_frag.pdb
! ic param
! ic build

! patch p2_10 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub10_frag.pdb
! ic param
! ic build

! patch p2_11 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub11_frag.pdb
! ic param
! ic build

! patch p2_12 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub12_frag.pdb
! ic param
! ic build

! patch p2_13 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub13_frag.pdb
! ic param
! ic build

! patch p2_14 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub14_frag.pdb
! ic param
! ic build

! patch p2_15 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub15_frag.pdb
! ic param
! ic build

! patch p2_16 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub16_frag.pdb
! ic param
! ic build

! patch p2_17 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub17_frag.pdb
! ic param
! ic build

! patch p2_18 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub18_frag.pdb
! ic param
! ic build

! patch p2_19 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub19_frag.pdb
! ic param
! ic build

! patch p2_20 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub20_frag.pdb
! ic param
! ic build

! patch p2_21 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub21_frag.pdb
! ic param
! ic build

! patch p2_22 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub22_frag.pdb
! ic param
! ic build

! patch p2_23 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub23_frag.pdb
! ic param
! ic build

! patch p2_24 @ligseg @resnum setup
! read coor pdb resid name @builddir/site2_sub24_frag.pdb
! ic param
! ic build

!! Read in LonePair sites (if applicable)
stream @builddir/lpsites.inp

!! Define MSLD substituent selections
define site1_sub1 - 
   select ( - 
   atom @ligseg @resnum C010 .or. -
   atom @ligseg @resnum H009 .or. -
   none ) end

define site1_sub2 - 
   select ( - 
   atom @ligseg @resnum O011 .or. -
   atom @ligseg @resnum H012 .or. -
   atom @ligseg @resnum C013 .or. -
   none ) end

define site1_sub3 - 
   select ( - 
   atom @ligseg @resnum C014 .or. -
   atom @ligseg @resnum H017 .or. -
   atom @ligseg @resnum H016 .or. -
   atom @ligseg @resnum H015 .or. -
   atom @ligseg @resnum C018 .or. -
   none ) end

define site1_sub4 - 
   select ( - 
   atom @ligseg @resnum C019 .or. -
   atom @ligseg @resnum H025 .or. -
   atom @ligseg @resnum H020 .or. -
   atom @ligseg @resnum C021 .or. -
   atom @ligseg @resnum H024 .or. -
   atom @ligseg @resnum H023 .or. -
   atom @ligseg @resnum H022 .or. -
   atom @ligseg @resnum C026 .or. -
   none ) end

define site1_sub5 - 
   select ( - 
   atom @ligseg @resnum C027 .or. -
   atom @ligseg @resnum H039 .or. -
   atom @ligseg @resnum H028 .or. -
   atom @ligseg @resnum C029 .or. -
   atom @ligseg @resnum H034 .or. -
   atom @ligseg @resnum C030 .or. -
   atom @ligseg @resnum H033 .or. -
   atom @ligseg @resnum H032 .or. -
   atom @ligseg @resnum H031 .or. -
   atom @ligseg @resnum C035 .or. -
   atom @ligseg @resnum H038 .or. -
   atom @ligseg @resnum H037 .or. -
   atom @ligseg @resnum H036 .or. -
   atom @ligseg @resnum C040 .or. -
   none ) end

define site1_sub6 - 
   select ( - 
   atom @ligseg @resnum C041 .or. -
   atom @ligseg @resnum H042 .or. -
   atom @ligseg @resnum O043 .or. -
   atom @ligseg @resnum C044 .or. -
   none ) end

define site1_sub7 - 
   select ( - 
   atom @ligseg @resnum C045 .or. -
   atom @ligseg @resnum C046 .or. -
   atom @ligseg @resnum H049 .or. -
   atom @ligseg @resnum H048 .or. -
   atom @ligseg @resnum H047 .or. -
   atom @ligseg @resnum O050 .or. -
   atom @ligseg @resnum C051 .or. -
   none ) end

define site1_sub8 - 
   select ( - 
   atom @ligseg @resnum C053 .or. -
   atom @ligseg @resnum C054 .or. -
   atom @ligseg @resnum H055 .or. -
   atom @ligseg @resnum C056 .or. -
   atom @ligseg @resnum H057 .or. -
   atom @ligseg @resnum C058 .or. -
   atom @ligseg @resnum H052 .or. -
   atom @ligseg @resnum C059 .or. -
   atom @ligseg @resnum H060 .or. -
   atom @ligseg @resnum C061 .or. -
   atom @ligseg @resnum H062 .or. -
   atom @ligseg @resnum C063 .or. -
   none ) end

define site1_sub9 - 
   select ( - 
   atom @ligseg @resnum C065 .or. -
   atom @ligseg @resnum H064 .or. -
   none ) end

define site1_sub10 - 
   select ( - 
   atom @ligseg @resnum O066 .or. -
   atom @ligseg @resnum H067 .or. -
   atom @ligseg @resnum C068 .or. -
   none ) end

define site1_sub11 - 
   select ( - 
   atom @ligseg @resnum C069 .or. -
   atom @ligseg @resnum H072 .or. -
   atom @ligseg @resnum H071 .or. -
   atom @ligseg @resnum H070 .or. -
   atom @ligseg @resnum C073 .or. -
   none ) end

define site1_sub12 - 
   select ( - 
   atom @ligseg @resnum C074 .or. -
   atom @ligseg @resnum H080 .or. -
   atom @ligseg @resnum H075 .or. -
   atom @ligseg @resnum C076 .or. -
   atom @ligseg @resnum H079 .or. -
   atom @ligseg @resnum H078 .or. -
   atom @ligseg @resnum H077 .or. -
   atom @ligseg @resnum C081 .or. -
   none ) end

define site1_sub13 - 
   select ( - 
   atom @ligseg @resnum C082 .or. -
   atom @ligseg @resnum H094 .or. -
   atom @ligseg @resnum H083 .or. -
   atom @ligseg @resnum C084 .or. -
   atom @ligseg @resnum H089 .or. -
   atom @ligseg @resnum C085 .or. -
   atom @ligseg @resnum H088 .or. -
   atom @ligseg @resnum H087 .or. -
   atom @ligseg @resnum H086 .or. -
   atom @ligseg @resnum C090 .or. -
   atom @ligseg @resnum H093 .or. -
   atom @ligseg @resnum H092 .or. -
   atom @ligseg @resnum H091 .or. -
   atom @ligseg @resnum C095 .or. -
   none ) end

define site1_sub14 - 
   select ( - 
   atom @ligseg @resnum C096 .or. -
   atom @ligseg @resnum H097 .or. -
   atom @ligseg @resnum O098 .or. -
   atom @ligseg @resnum C099 .or. -
   none ) end

define site1_sub15 - 
   select ( - 
   atom @ligseg @resnum C100 .or. -
   atom @ligseg @resnum C101 .or. -
   atom @ligseg @resnum H104 .or. -
   atom @ligseg @resnum H103 .or. -
   atom @ligseg @resnum H102 .or. -
   atom @ligseg @resnum O105 .or. -
   atom @ligseg @resnum C106 .or. -
   none ) end

define site1_sub16 - 
   select ( - 
   atom @ligseg @resnum C108 .or. -
   atom @ligseg @resnum C109 .or. -
   atom @ligseg @resnum H110 .or. -
   atom @ligseg @resnum C111 .or. -
   atom @ligseg @resnum H112 .or. -
   atom @ligseg @resnum C113 .or. -
   atom @ligseg @resnum H107 .or. -
   atom @ligseg @resnum C114 .or. -
   atom @ligseg @resnum H115 .or. -
   atom @ligseg @resnum C116 .or. -
   atom @ligseg @resnum H117 .or. -
   atom @ligseg @resnum C118 .or. -
   none ) end

define site1_sub17 - 
   select ( - 
   atom @ligseg @resnum C120 .or. -
   atom @ligseg @resnum H119 .or. -
   none ) end

define site1_sub18 - 
   select ( - 
   atom @ligseg @resnum O121 .or. -
   atom @ligseg @resnum H122 .or. -
   atom @ligseg @resnum C123 .or. -
   none ) end

define site1_sub19 - 
   select ( - 
   atom @ligseg @resnum C124 .or. -
   atom @ligseg @resnum H127 .or. -
   atom @ligseg @resnum H126 .or. -
   atom @ligseg @resnum H125 .or. -
   atom @ligseg @resnum C128 .or. -
   none ) end

define site1_sub20 - 
   select ( - 
   atom @ligseg @resnum C129 .or. -
   atom @ligseg @resnum H135 .or. -
   atom @ligseg @resnum H130 .or. -
   atom @ligseg @resnum C131 .or. -
   atom @ligseg @resnum H134 .or. -
   atom @ligseg @resnum H133 .or. -
   atom @ligseg @resnum H132 .or. -
   atom @ligseg @resnum C136 .or. -
   none ) end

define site1_sub21 - 
   select ( - 
   atom @ligseg @resnum C137 .or. -
   atom @ligseg @resnum H149 .or. -
   atom @ligseg @resnum H138 .or. -
   atom @ligseg @resnum C139 .or. -
   atom @ligseg @resnum H144 .or. -
   atom @ligseg @resnum C140 .or. -
   atom @ligseg @resnum H143 .or. -
   atom @ligseg @resnum H142 .or. -
   atom @ligseg @resnum H141 .or. -
   atom @ligseg @resnum C145 .or. -
   atom @ligseg @resnum H148 .or. -
   atom @ligseg @resnum H147 .or. -
   atom @ligseg @resnum H146 .or. -
   atom @ligseg @resnum C150 .or. -
   none ) end

define site1_sub22 - 
   select ( - 
   atom @ligseg @resnum C151 .or. -
   atom @ligseg @resnum H152 .or. -
   atom @ligseg @resnum O153 .or. -
   atom @ligseg @resnum C154 .or. -
   none ) end

define site1_sub23 - 
   select ( - 
   atom @ligseg @resnum C155 .or. -
   atom @ligseg @resnum C156 .or. -
   atom @ligseg @resnum H159 .or. -
   atom @ligseg @resnum H158 .or. -
   atom @ligseg @resnum H157 .or. -
   atom @ligseg @resnum O160 .or. -
   atom @ligseg @resnum C161 .or. -
   none ) end

define site1_sub24 - 
   select ( - 
   atom @ligseg @resnum C163 .or. -
   atom @ligseg @resnum C164 .or. -
   atom @ligseg @resnum H165 .or. -
   atom @ligseg @resnum C166 .or. -
   atom @ligseg @resnum H167 .or. -
   atom @ligseg @resnum C168 .or. -
   atom @ligseg @resnum H162 .or. -
   atom @ligseg @resnum C169 .or. -
   atom @ligseg @resnum H170 .or. -
   atom @ligseg @resnum C171 .or. -
   atom @ligseg @resnum H172 .or. -
   atom @ligseg @resnum C173 .or. -
   none ) end

define site2_sub1 - 
   select ( - 
   atom @ligseg @resnum C175 .or. -
   atom @ligseg @resnum H174 .or. -
   none ) end

define site2_sub2 - 
   select ( - 
   atom @ligseg @resnum O176 .or. -
   atom @ligseg @resnum H177 .or. -
   atom @ligseg @resnum C178 .or. -
   none ) end

define site2_sub3 - 
   select ( - 
   atom @ligseg @resnum C179 .or. -
   atom @ligseg @resnum H182 .or. -
   atom @ligseg @resnum H181 .or. -
   atom @ligseg @resnum H180 .or. -
   atom @ligseg @resnum C183 .or. -
   none ) end

define site2_sub4 - 
   select ( - 
   atom @ligseg @resnum C184 .or. -
   atom @ligseg @resnum H190 .or. -
   atom @ligseg @resnum H185 .or. -
   atom @ligseg @resnum C186 .or. -
   atom @ligseg @resnum H188 .or. -
   atom @ligseg @resnum H189 .or. -
   atom @ligseg @resnum H187 .or. -
   atom @ligseg @resnum C191 .or. -
   none ) end

define site2_sub5 - 
   select ( - 
   atom @ligseg @resnum C192 .or. -
   atom @ligseg @resnum H204 .or. -
   atom @ligseg @resnum H193 .or. -
   atom @ligseg @resnum C194 .or. -
   atom @ligseg @resnum H199 .or. -
   atom @ligseg @resnum C195 .or. -
   atom @ligseg @resnum H197 .or. -
   atom @ligseg @resnum H198 .or. -
   atom @ligseg @resnum H196 .or. -
   atom @ligseg @resnum C200 .or. -
   atom @ligseg @resnum H203 .or. -
   atom @ligseg @resnum H202 .or. -
   atom @ligseg @resnum H201 .or. -
   atom @ligseg @resnum C205 .or. -
   none ) end

define site2_sub6 - 
   select ( - 
   atom @ligseg @resnum C206 .or. -
   atom @ligseg @resnum H207 .or. -
   atom @ligseg @resnum O208 .or. -
   atom @ligseg @resnum C209 .or. -
   none ) end

define site2_sub7 - 
   select ( - 
   atom @ligseg @resnum C210 .or. -
   atom @ligseg @resnum C211 .or. -
   atom @ligseg @resnum H214 .or. -
   atom @ligseg @resnum H213 .or. -
   atom @ligseg @resnum H212 .or. -
   atom @ligseg @resnum O215 .or. -
   atom @ligseg @resnum C216 .or. -
   none ) end

define site2_sub8 - 
   select ( - 
   atom @ligseg @resnum C217 .or. -
   atom @ligseg @resnum C218 .or. -
   atom @ligseg @resnum H219 .or. -
   atom @ligseg @resnum C220 .or. -
   atom @ligseg @resnum H221 .or. -
   atom @ligseg @resnum C222 .or. -
   atom @ligseg @resnum H223 .or. -
   atom @ligseg @resnum C224 .or. -
   atom @ligseg @resnum H225 .or. -
   atom @ligseg @resnum C226 .or. -
   atom @ligseg @resnum H227 .or. -
   atom @ligseg @resnum C228 .or. -
   none ) end

define site2_sub9 - 
   select ( - 
   atom @ligseg @resnum C230 .or. -
   atom @ligseg @resnum H229 .or. -
   none ) end

define site2_sub10 - 
   select ( - 
   atom @ligseg @resnum O231 .or. -
   atom @ligseg @resnum H232 .or. -
   atom @ligseg @resnum C233 .or. -
   none ) end

define site2_sub11 - 
   select ( - 
   atom @ligseg @resnum C234 .or. -
   atom @ligseg @resnum H237 .or. -
   atom @ligseg @resnum H236 .or. -
   atom @ligseg @resnum H235 .or. -
   atom @ligseg @resnum C238 .or. -
   none ) end

define site2_sub12 - 
   select ( - 
   atom @ligseg @resnum C239 .or. -
   atom @ligseg @resnum H245 .or. -
   atom @ligseg @resnum H240 .or. -
   atom @ligseg @resnum C241 .or. -
   atom @ligseg @resnum H243 .or. -
   atom @ligseg @resnum H244 .or. -
   atom @ligseg @resnum H242 .or. -
   atom @ligseg @resnum C246 .or. -
   none ) end

define site2_sub13 - 
   select ( - 
   atom @ligseg @resnum C247 .or. -
   atom @ligseg @resnum H259 .or. -
   atom @ligseg @resnum H248 .or. -
   atom @ligseg @resnum C249 .or. -
   atom @ligseg @resnum H254 .or. -
   atom @ligseg @resnum C250 .or. -
   atom @ligseg @resnum H252 .or. -
   atom @ligseg @resnum H253 .or. -
   atom @ligseg @resnum H251 .or. -
   atom @ligseg @resnum C255 .or. -
   atom @ligseg @resnum H258 .or. -
   atom @ligseg @resnum H257 .or. -
   atom @ligseg @resnum H256 .or. -
   atom @ligseg @resnum C260 .or. -
   none ) end

define site2_sub14 - 
   select ( - 
   atom @ligseg @resnum C261 .or. -
   atom @ligseg @resnum H262 .or. -
   atom @ligseg @resnum O263 .or. -
   atom @ligseg @resnum C264 .or. -
   none ) end

define site2_sub15 - 
   select ( - 
   atom @ligseg @resnum C265 .or. -
   atom @ligseg @resnum C266 .or. -
   atom @ligseg @resnum H269 .or. -
   atom @ligseg @resnum H268 .or. -
   atom @ligseg @resnum H267 .or. -
   atom @ligseg @resnum O270 .or. -
   atom @ligseg @resnum C271 .or. -
   none ) end

define site2_sub16 - 
   select ( - 
   atom @ligseg @resnum C272 .or. -
   atom @ligseg @resnum C273 .or. -
   atom @ligseg @resnum H274 .or. -
   atom @ligseg @resnum C275 .or. -
   atom @ligseg @resnum H276 .or. -
   atom @ligseg @resnum C277 .or. -
   atom @ligseg @resnum H278 .or. -
   atom @ligseg @resnum C279 .or. -
   atom @ligseg @resnum H280 .or. -
   atom @ligseg @resnum C281 .or. -
   atom @ligseg @resnum H282 .or. -
   atom @ligseg @resnum C283 .or. -
   none ) end

define site2_sub17 - 
   select ( - 
   atom @ligseg @resnum C285 .or. -
   atom @ligseg @resnum H284 .or. -
   none ) end

define site2_sub18 - 
   select ( - 
   atom @ligseg @resnum O286 .or. -
   atom @ligseg @resnum H287 .or. -
   atom @ligseg @resnum C288 .or. -
   none ) end

define site2_sub19 - 
   select ( - 
   atom @ligseg @resnum C289 .or. -
   atom @ligseg @resnum H292 .or. -
   atom @ligseg @resnum H291 .or. -
   atom @ligseg @resnum H290 .or. -
   atom @ligseg @resnum C293 .or. -
   none ) end

define site2_sub20 - 
   select ( - 
   atom @ligseg @resnum C294 .or. -
   atom @ligseg @resnum H300 .or. -
   atom @ligseg @resnum H295 .or. -
   atom @ligseg @resnum C296 .or. -
   atom @ligseg @resnum H298 .or. -
   atom @ligseg @resnum H299 .or. -
   atom @ligseg @resnum H297 .or. -
   atom @ligseg @resnum C301 .or. -
   none ) end

define site2_sub21 - 
   select ( - 
   atom @ligseg @resnum C302 .or. -
   atom @ligseg @resnum H314 .or. -
   atom @ligseg @resnum H303 .or. -
   atom @ligseg @resnum C304 .or. -
   atom @ligseg @resnum H309 .or. -
   atom @ligseg @resnum C305 .or. -
   atom @ligseg @resnum H307 .or. -
   atom @ligseg @resnum H308 .or. -
   atom @ligseg @resnum H306 .or. -
   atom @ligseg @resnum C310 .or. -
   atom @ligseg @resnum H313 .or. -
   atom @ligseg @resnum H312 .or. -
   atom @ligseg @resnum H311 .or. -
   atom @ligseg @resnum C315 .or. -
   none ) end

define site2_sub22 - 
   select ( - 
   atom @ligseg @resnum C316 .or. -
   atom @ligseg @resnum H317 .or. -
   atom @ligseg @resnum O318 .or. -
   atom @ligseg @resnum C319 .or. -
   none ) end

define site2_sub23 - 
   select ( - 
   atom @ligseg @resnum C320 .or. -
   atom @ligseg @resnum C321 .or. -
   atom @ligseg @resnum H324 .or. -
   atom @ligseg @resnum H323 .or. -
   atom @ligseg @resnum H322 .or. -
   atom @ligseg @resnum O325 .or. -
   atom @ligseg @resnum C326 .or. -
   none ) end

define site2_sub24 - 
   select ( - 
   atom @ligseg @resnum C327 .or. -
   atom @ligseg @resnum C328 .or. -
   atom @ligseg @resnum H329 .or. -
   atom @ligseg @resnum C330 .or. -
   atom @ligseg @resnum H331 .or. -
   atom @ligseg @resnum C332 .or. -
   atom @ligseg @resnum H333 .or. -
   atom @ligseg @resnum C334 .or. -
   atom @ligseg @resnum H335 .or. -
   atom @ligseg @resnum C336 .or. -
   atom @ligseg @resnum H337 .or. -
   atom @ligseg @resnum C338 .or. -
   none ) end

auto angle dihe  !! do not call after deleting sub-sub terms or loading in water
bomblev -1

! delete angles and dihedrals between alchem groups
set ii = 1
label deletesiteloop
if @ii .le. @nsites then

   set jj = 1
   label delete1loop
   if @jj .le. @nsubs@@ii then

      calc kk = @jj + 1
      label delete2loop
      if @kk .le. @nsubs@@ii then

         dele connectivity sele ( site@{ii}_sub@@jj ) show end sele ( site@{ii}_sub@@kk ) show end
         calc kk = @kk + 1
         goto delete2loop
      endif

      calc jj = @jj + 1
      goto delete1loop
   endif

   calc ii = @ii + 1
   goto deletesiteloop
endif

!! ! System specific deletion (linear groups)
!! dele dihe sele (atom LIG 1 ATOMNAME) show end

!! Load solvent
stream prep/toppar/toppar_water_ions.str

read sequ pdb name @builddir/solvent.pdb
generate WT00 first none last none setup noangl nodihe
read coor pdb resid name @builddir/solvent.pdb

!! !! Load ions
!! read sequ pdb name @builddir/ions.pdb
!! generate HETA first none last none setup noangl nodihe
!! read coor pdb resid name @builddir/ions.pdb

print coor sele .not. init end

bomblev 0

!! !! Write Initial System to Disk
!! write psf card name patch.psf
!! * patch psf file
!! *
!! write coor pdb card name patch.pdb
!! * patch pdb file
!! *
!! write coor card name patch.crd
!! * patch crd file
!! *

!! Create water box & periodic images
coor stat
crystal define cubic @box @box @box 90. 90. 90.
crystal build cutoff 14 nope 0
image byres xcen 0 ycen 0 zcen 0 sele resn tip3 .or. resn sod .or. resn cla end
image byseg xcen 0 ycen 0 zcen 0 sele .not. ( resn tip3 .or. resn sod .or. resn cla ) end

!! Copy main coords into comp set
cons harm clear
coor copy comp

! LDBI math: for every "pair" there are 5 ldbi's
set ii = 1
set ldbibias = 0
label ldbimathloop
if @ii .le. @nsites then
   calc ldbibias = @ldbibias + ( ( @nsubs@@ii * (@nsubs@@ii - 1) / 2 ) * 5 )
   INCR ii by 1
   goto ldbimathloop
endif
set charge = ?cgtot

! for i in 1 2; do for j in `seq 1 24`; do grep BOND prep/site${i}_sub${j}_pres.rtf | grep C001 | awk '{print $3}'; done; done
set s1s1a1 = C010
set s1s2a1 = C013
set s1s3a1 = C018
set s1s4a1 = C026
set s1s5a1 = C040
set s1s6a1 = C044
set s1s7a1 = C051
set s1s8a1 = C063
set s1s9a1 = C065
set s1s10a1 = C068
set s1s11a1 = C073
set s1s12a1 = C081
set s1s13a1 = C095
set s1s14a1 = C099
set s1s15a1 = C106
set s1s16a1 = C118
set s1s17a1 = C120
set s1s18a1 = C123
set s1s19a1 = C128
set s1s20a1 = C136
set s1s21a1 = C150
set s1s22a1 = C154
set s1s23a1 = C161
set s1s24a1 = C173
! for i in 1 2; do for j in `seq 1 24`; do grep BOND prep/site${i}_sub${j}_pres.rtf | grep C005 | awk '{print $3}'; done; done
set s2s1a1 = C175
set s2s2a1 = C178
set s2s3a1 = C183
set s2s4a1 = C191
set s2s5a1 = C205
set s2s6a1 = C209
set s2s7a1 = C216
set s2s8a1 = C228
set s2s9a1 = C230
set s2s10a1 = C233
set s2s11a1 = C238
set s2s12a1 = C246
set s2s13a1 = C260
set s2s14a1 = C264
set s2s15a1 = C271
set s2s16a1 = C283
set s2s17a1 = C285
set s2s18a1 = C288
set s2s19a1 = C293
set s2s20a1 = C301
set s2s21a1 = C315
set s2s22a1 = C319
set s2s23a1 = C326
set s2s24a1 = C338
! for i in C010 C013 C018 C026 C040 C044 C051 C063 C065 C068 C073 C081 C095 C099 C106 C118 C120 C123 C128 C136 C150 C154 C161 C173; do grep $i prep/site*_pres.rtf | grep BOND | grep -v "C001\|C003\|C005\|C007"| awk '{print $2$3}'|sed s/$i//; done
set s1s1a2 = H009
set s1s2a2 = O011
set s1s3a2 = C014
set s1s4a2 = C019
set s1s5a2 = C027
set s1s6a2 = C041
set s1s7a2 = C045
set s1s8a2 = C053
set s1s9a2 = H064
set s1s10a2 = O066
set s1s11a2 = C069
set s1s12a2 = C074
set s1s13a2 = C082
set s1s14a2 = C096
set s1s15a2 = C100
set s1s16a2 = C108
set s1s17a2 = H119
set s1s18a2 = O121
set s1s19a2 = C124
set s1s20a2 = C129
set s1s21a2 = C137
set s1s22a2 = C151
set s1s23a2 = C155
set s1s24a2 = C163
! for i in C175 C178 C183 C191 C205 C209 C216 C228 C230 C233 C238 C246 C260 C264 C271 C283 C285 C288 C293 C301 C315 C319 C326 C338; do grep $i prep/site*_pres.rtf | grep BOND | grep -v "C001\|C003\|C005\|C007"| awk '{print $2$3}'|sed s/$i//; done
set s2s1a2 = H174
set s2s2a2 = O176
set s2s3a2 = C179
set s2s4a2 = C184
set s2s5a2 = C192
set s2s6a2 = C206
set s2s7a2 = C210
set s2s8a2 = C217
set s2s9a2 = H229
set s2s10a2 = O231
set s2s11a2 = C234
set s2s12a2 = C239
set s2s13a2 = C247
set s2s14a2 = C261
set s2s15a2 = C265
set s2s16a2 = C272
set s2s17a2 = H284
set s2s18a2 = O286
set s2s19a2 = C289
set s2s20a2 = C294
set s2s21a2 = C302
set s2s22a2 = C316
set s2s23a2 = C320
set s2s24a2 = C327

set s1C001 = C001
set s1C007 = C007
set s2C001 = C003
set s2C007 = C005

calc blockplusone = @nblocks + 1

!! BLOCK setup
BLOCK @blockplusone
   clear
END
if @nreps .gt. 1 then
BLOCK @blockplusone NREP @nreps
else
BLOCK @blockplusone
endif
   Call 2 sele site1_sub1 show end
   Call 3 sele site1_sub2 show end
   Call 4 sele site1_sub3 show end
   Call 5 sele site1_sub4 show end
   Call 6 sele site1_sub5 show end
   Call 7 sele site1_sub6 show end
   Call 8 sele site1_sub7 show end
   Call 9 sele site1_sub8 show end
!    Call 10 sele site1_sub9 show end
!    Call 11 sele site1_sub10 show end
!    Call 12 sele site1_sub11 show end
!    Call 13 sele site1_sub12 show end
!    Call 14 sele site1_sub13 show end
!    Call 15 sele site1_sub14 show end
!    Call 16 sele site1_sub15 show end
!    Call 17 sele site1_sub16 show end
!    Call 18 sele site1_sub17 show end
!    Call 19 sele site1_sub18 show end
!    Call 20 sele site1_sub19 show end
!    Call 21 sele site1_sub20 show end
!    Call 22 sele site1_sub21 show end
!    Call 23 sele site1_sub22 show end
!    Call 24 sele site1_sub23 show end
!    Call 25 sele site1_sub24 show end
   Call 10 sele site2_sub1 show end
   Call 11 sele site2_sub2 show end
   Call 12 sele site2_sub3 show end
   Call 13 sele site2_sub4 show end
   Call 14 sele site2_sub5 show end
   Call 15 sele site2_sub6 show end
   Call 16 sele site2_sub7 show end
   Call 17 sele site2_sub8 show end
!    Call 34 sele site2_sub9 show end
!    Call 35 sele site2_sub10 show end
!    Call 36 sele site2_sub11 show end
!    Call 37 sele site2_sub12 show end
!    Call 38 sele site2_sub13 show end
!    Call 39 sele site2_sub14 show end
!    Call 40 sele site2_sub15 show end
!    Call 41 sele site2_sub16 show end
!    Call 42 sele site2_sub17 show end
!    Call 43 sele site2_sub18 show end
!    Call 44 sele site2_sub19 show end
!    Call 45 sele site2_sub20 show end
!    Call 46 sele site2_sub21 show end
!    Call 47 sele site2_sub22 show end
!    Call 48 sele site2_sub23 show end
!    Call 49 sele site2_sub24 show end

   qldm theta
   lang temp @temp
if @nreps .gt. 1 then
   phmd ph 7
endif
   soft on   ! this turns on soft-cores
   pmel ex   ! this turns on PME

   ldin 1 1.0  0.0  5.0  0.0  5.0
if @nreps .gt. 1 then
   ldin 2  0.0417 0.0  5.0  @lams1s1 5.0 NONE
   ldin 3  0.0417 0.0  5.0  @lams1s2 5.0 FIX 7.0
   ldin 4  0.0417 0.0  5.0  @lams1s3 5.0 FIX 7.0
   ldin 5  0.0417 0.0  5.0  @lams1s4 5.0 FIX 7.0
   ldin 6  0.0417 0.0  5.0  @lams1s5 5.0 FIX 7.0
   ldin 7  0.0417 0.0  5.0  @lams1s6 5.0 FIX 7.0
   ldin 8  0.0417 0.0  5.0  @lams1s7 5.0 FIX 7.0
   ldin 9  0.0417 0.0  5.0  @lams1s8 5.0 FIX 7.0
   ldin 10 0.0417 0.0  5.0  @lams2s1 5.0 NONE
   ldin 11 0.0417 0.0  5.0  @lams2s2 5.0 FIX 7.0
   ldin 12 0.0417 0.0  5.0  @lams2s3 5.0 FIX 7.0
   ldin 13 0.0417 0.0  5.0  @lams2s4 5.0 FIX 7.0
   ldin 14 0.0417 0.0  5.0  @lams2s5 5.0 FIX 7.0
   ldin 15 0.0417 0.0  5.0  @lams2s6 5.0 FIX 7.0
   ldin 16 0.0417 0.0  5.0  @lams2s7 5.0 FIX 7.0
   ldin 17 0.0417 0.0  5.0  @lams2s8 5.0 FIX 7.0
!    ldin 18 0.0417 0.0  5.0  @lams1s17 5.0 FIX 7.0
!    ldin 19 0.0417 0.0  5.0  @lams1s18 5.0 FIX 7.0
!    ldin 20 0.0417 0.0  5.0  @lams1s19 5.0 FIX 7.0
!    ldin 21 0.0417 0.0  5.0  @lams1s20 5.0 FIX 7.0
!    ldin 22 0.0417 0.0  5.0  @lams1s21 5.0 FIX 7.0
!    ldin 23 0.0417 0.0  5.0  @lams1s22 5.0 FIX 7.0
!    ldin 24 0.0417 0.0  5.0  @lams1s23 5.0 FIX 7.0
!    ldin 25 0.0417 0.0  5.0  @lams1s24 5.0 FIX 7.0
!    ldin 26 0.0417 0.0  5.0  @lams2s1 5.0 FIX 7.0 
!    ldin 27 0.0417 0.0  5.0  @lams2s2 5.0 FIX 7.0
!    ldin 28 0.0417 0.0  5.0  @lams2s3 5.0 FIX 7.0
!    ldin 29 0.0417 0.0  5.0  @lams2s4 5.0 FIX 7.0
!    ldin 30 0.0417 0.0  5.0  @lams2s5 5.0 FIX 7.0
!    ldin 31 0.0417 0.0  5.0  @lams2s6 5.0 FIX 7.0
!    ldin 32 0.0417 0.0  5.0  @lams2s7 5.0 FIX 7.0
!    ldin 33 0.0417 0.0  5.0  @lams2s8 5.0 FIX 7.0
!    ldin 34 0.0417 0.0  5.0  @lams2s9 5.0 FIX 7.0
!    ldin 35 0.0417 0.0  5.0  @lams2s10 5.0 FIX 7.0
!    ldin 36 0.0417 0.0  5.0  @lams2s11 5.0 FIX 7.0
!    ldin 37 0.0417 0.0  5.0  @lams2s12 5.0 FIX 7.0
!    ldin 38 0.0417 0.0  5.0  @lams2s13 5.0 FIX 7.0
!    ldin 39 0.0417 0.0  5.0  @lams2s14 5.0 FIX 7.0
!    ldin 40 0.0417 0.0  5.0  @lams2s15 5.0 FIX 7.0
!    ldin 41 0.0417 0.0  5.0  @lams2s16 5.0 FIX 7.0
!    ldin 42 0.0417 0.0  5.0  @lams2s17 5.0 FIX 7.0
!    ldin 43 0.0417 0.0  5.0  @lams2s18 5.0 FIX 7.0
!    ldin 44 0.0417 0.0  5.0  @lams2s19 5.0 FIX 7.0
!    ldin 45 0.0417 0.0  5.0  @lams2s20 5.0 FIX 7.0
!    ldin 46 0.0417 0.0  5.0  @lams2s21 5.0 FIX 7.0
!    ldin 47 0.0417 0.0  5.0  @lams2s22 5.0 FIX 7.0
!    ldin 48 0.0417 0.0  5.0  @lams2s23 5.0 FIX 7.0
!    ldin 49 0.0417 0.0  5.0  @lams2s24 5.0 FIX 7.0
else
   ldin 2  0.0417 0.0  5.0  @lams1s1 5.0 !RX! NONE
   ldin 3  0.0417 0.0  5.0  @lams1s2 5.0 !RX! UNEG 7.0
   ldin 4  0.0417 0.0  5.0  @lams1s3 5.0 !RX! UPOS 7.0
   ldin 5  0.0417 0.0  5.0  @lams1s4 5.0 !RX! UNEG 7.0
   ldin 6  0.0417 0.0  5.0  @lams1s5 5.0 !RX! UPOS 7.0
   ldin 7  0.0417 0.0  5.0  @lams1s6 5.0 !RX! UNEG 7.0
   ldin 8  0.0417 0.0  5.0  @lams1s7 5.0 !RX! UPOS 7.0
   ldin 9  0.0417 0.0  5.0  @lams1s8 5.0 !RX! UNEG 7.0
   ldin 10 0.0417 0.0  5.0  @lams2s1 5.0 !RX! NONE
   ldin 11 0.0417 0.0  5.0  @lams2s2 5.0 !RX! UNEG 7.0
   ldin 12 0.0417 0.0  5.0  @lams2s3 5.0 !RX! UPOS 7.0
   ldin 13 0.0417 0.0  5.0  @lams2s4 5.0 !RX! UNEG 7.0
   ldin 14 0.0417 0.0  5.0  @lams2s5 5.0 !RX! UPOS 7.0
   ldin 15 0.0417 0.0  5.0  @lams2s6 5.0 !RX! UNEG 7.0
   ldin 16 0.0417 0.0  5.0  @lams2s7 5.0 !RX! UPOS 7.0
   ldin 17 0.0417 0.0  5.0  @lams2s8 5.0 !RX! UNEG 7.0
!    ldin 18 0.0417 0.0  5.0  @lams1s17 5.0 !RX! UPOS 7.0
!    ldin 19 0.0417 0.0  5.0  @lams1s18 5.0 !RX! UNEG 7.0
!    ldin 20 0.0417 0.0  5.0  @lams1s19 5.0 !RX! UPOS 7.0
!    ldin 21 0.0417 0.0  5.0  @lams1s20 5.0 !RX! UNEG 7.0
!    ldin 22 0.0417 0.0  5.0  @lams1s21 5.0 !RX! UPOS 7.0
!    ldin 23 0.0417 0.0  5.0  @lams1s22 5.0 !RX! UNEG 7.0
!    ldin 24 0.0417 0.0  5.0  @lams1s23 5.0 !RX! UPOS 7.0
!    ldin 25 0.0417 0.0  5.0  @lams1s24 5.0 !RX! UNEG 7.0
!    ldin 26 0.0417 0.0  5.0  @lams2s1 5.0 !RX! NONE
!    ldin 27 0.0417 0.0  5.0  @lams2s2 5.0 !RX! UNEG 7.0
!    ldin 28 0.0417 0.0  5.0  @lams2s3 5.0 !RX! UPOS 7.0
!    ldin 29 0.0417 0.0  5.0  @lams2s4 5.0 !RX! UNEG 7.0
!    ldin 30 0.0417 0.0  5.0  @lams2s5 5.0 !RX! UPOS 7.0
!    ldin 31 0.0417 0.0  5.0  @lams2s6 5.0 !RX! UNEG 7.0
!    ldin 32 0.0417 0.0  5.0  @lams2s7 5.0 !RX! UPOS 7.0
!    ldin 33 0.0417 0.0  5.0  @lams2s8 5.0 !RX! UNEG 7.0
!    ldin 34 0.0417 0.0  5.0  @lams2s9 5.0 !RX! UPOS 7.0
!    ldin 35 0.0417 0.0  5.0  @lams2s10 5.0 !RX! UNEG 7.0
!    ldin 36 0.0417 0.0  5.0  @lams2s11 5.0 !RX! UPOS 7.0
!    ldin 37 0.0417 0.0  5.0  @lams2s12 5.0 !RX! UNEG 7.0
!    ldin 38 0.0417 0.0  5.0  @lams2s13 5.0 !RX! UPOS 7.0
!    ldin 39 0.0417 0.0  5.0  @lams2s14 5.0 !RX! UNEG 7.0
!    ldin 40 0.0417 0.0  5.0  @lams2s15 5.0 !RX! UPOS 7.0
!    ldin 41 0.0417 0.0  5.0  @lams2s16 5.0 !RX! UNEG 7.0
!    ldin 42 0.0417 0.0  5.0  @lams2s17 5.0 !RX! UPOS 7.0
!    ldin 43 0.0417 0.0  5.0  @lams2s18 5.0 !RX! UNEG 7.0
!    ldin 44 0.0417 0.0  5.0  @lams2s19 5.0 !RX! UPOS 7.0
!    ldin 45 0.0417 0.0  5.0  @lams2s20 5.0 !RX! UNEG 7.0
!    ldin 46 0.0417 0.0  5.0  @lams2s21 5.0 !RX! UPOS 7.0
!    ldin 47 0.0417 0.0  5.0  @lams2s22 5.0 !RX! UNEG 7.0
!    ldin 48 0.0417 0.0  5.0  @lams2s23 5.0 !RX! UPOS 7.0
!    ldin 49 0.0417 0.0  5.0  @lams2s24 5.0 !RX! UNEG 7.0
endif

   ! set excl1 = 2 3 2 4 2 5 2 6 2 7 2 8 2 9 2 10 2 11 2 12 2 13
   ! set excl2 = 2 14 2 15 2 16 2 17 2 18 2 19 2 20 2 21 2 22 2 23 2 24
   ! set excl3 = 2 25 3 4 3 5 3 6 3 7 3 8 3 9 3 10 3 11 3 12 3 13
   ! set excl4 = 3 14 3 15 3 16 3 17 3 18 3 19 3 20 3 21 3 22 3 23 3 24
   ! set excl5 = 3 25 4 5 4 6 4 7 4 8 4 9 4 10 4 11 4 12 4 13 4 14
   ! set excl6 = 4 15 4 16 4 17 4 18 4 19 4 20 4 21 4 22 4 23 4 24 4 25
   ! set excl7 = 5 6 5 7 5 8 5 9 5 10 5 11 5 12 5 13 5 14 5 15 5 16
   ! set excl8 = 5 17 5 18 5 19 5 20 5 21 5 22 5 23 5 24 5 25 6 7 6 8
   ! set excl9 = 6 9 6 10 6 11 6 12 6 13 6 14 6 15 6 16 6 17 6 18 6 19
   ! set excl10 = 6 20 6 21 6 22 6 23 6 24 6 25 7 8 7 9 7 10 7 11 7 12
   ! set excl11 = 7 13 7 14 7 15 7 16 7 17 7 18 7 19 7 20 7 21 7 22 7 23
   ! set excl12 = 7 24 7 25 8 9 8 10 8 11 8 12 8 13 8 14 8 15 8 16 8 17
   ! set excl13 = 8 18 8 19 8 20 8 21 8 22 8 23 8 24 8 25 9 10 9 11 9 12
   ! set excl14 = 9 13 9 14 9 15 9 16 9 17 9 18 9 19 9 20 9 21 9 22 9 23
   ! set excl15 = 9 24 9 25 10 11 10 12 10 13 10 14 10 15 10 16 10 17 10 18 10 19
   ! set excl16 = 10 20 10 21 10 22 10 23 10 24 10 25 11 12 11 13 11 14 11 15 11 16
   ! set excl17 = 11 17 11 18 11 19 11 20 11 21 11 22 11 23 11 24 11 25 12 13 12 14
   ! set excl18 = 12 15 12 16 12 17 12 18 12 19 12 20 12 21 12 22 12 23 12 24 12 25
   ! set excl19 = 13 14 13 15 13 16 13 17 13 18 13 19 13 20 13 21 13 22 13 23 13 24
   ! set excl20 = 13 25 14 15 14 16 14 17 14 18 14 19 14 20 14 21 14 22 14 23 14 24
   ! set excl21 = 14 25 15 16 15 17 15 18 15 19 15 20 15 21 15 22 15 23 15 24 15 25
   ! set excl22 = 16 17 16 18 16 19 16 20 16 21 16 22 16 23 16 24 16 25 17 18 17 19
   ! set excl23 = 17 20 17 21 17 22 17 23 17 24 17 25 18 19 18 20 18 21 18 22 18 23
   ! set excl24 = 18 24 18 25 19 20 19 21 19 22 19 23 19 24 19 25 20 21 20 22 20 23
   ! set excl25 = 20 24 20 25 21 22 21 23 21 24 21 25 22 23 22 24 22 25 23 24 23 25
   ! set excl26 = 24 25 26 27 26 28 26 29 26 30 26 31 26 32 26 33 26 34 26 35 26 36
   ! set excl27 = 26 37 26 38 26 39 26 40 26 41 26 42 26 43 26 44 26 45 26 46 26 47
   ! set excl28 = 26 48 26 49 27 28 27 29 27 30 27 31 27 32 27 33 27 34 27 35 27 36
   ! set excl29 = 27 37 27 38 27 39 27 40 27 41 27 42 27 43 27 44 27 45 27 46 27 47
   ! set excl30 = 27 48 27 49 28 29 28 30 28 31 28 32 28 33 28 34 28 35 28 36 28 37
   ! set excl31 = 28 38 28 39 28 40 28 41 28 42 28 43 28 44 28 45 28 46 28 47 28 48
   ! set excl32 = 28 49 29 30 29 31 29 32 29 33 29 34 29 35 29 36 29 37 29 38 29 39
   ! set excl33 = 29 40 29 41 29 42 29 43 29 44 29 45 29 46 29 47 29 48 29 49 30 31
   ! set excl34 = 30 32 30 33 30 34 30 35 30 36 30 37 30 38 30 39 30 40 30 41 30 42
   ! set excl35 = 30 43 30 44 30 45 30 46 30 47 30 48 30 49 31 32 31 33 31 34 31 35
   ! set excl36 = 31 36 31 37 31 38 31 39 31 40 31 41 31 42 31 43 31 44 31 45 31 46
   ! set excl37 = 31 47 31 48 31 49 32 33 32 34 32 35 32 36 32 37 32 38 32 39 32 40
   ! set excl38 = 32 41 32 42 32 43 32 44 32 45 32 46 32 47 32 48 32 49 33 34 33 35
   ! set excl39 = 33 36 33 37 33 38 33 39 33 40 33 41 33 42 33 43 33 44 33 45 33 46
   ! set excl40 = 33 47 33 48 33 49 34 35 34 36 34 37 34 38 34 39 34 40 34 41 34 42
   ! set excl41 = 34 43 34 44 34 45 34 46 34 47 34 48 34 49 35 36 35 37 35 38 35 39
   ! set excl42 = 35 40 35 41 35 42 35 43 35 44 35 45 35 46 35 47 35 48 35 49 36 37
   ! set excl43 = 36 38 36 39 36 40 36 41 36 42 36 43 36 44 36 45 36 46 36 47 36 48
   ! set excl44 = 36 49 37 38 37 39 37 40 37 41 37 42 37 43 37 44 37 45 37 46 37 47
   ! set excl45 = 37 48 37 49 38 39 38 40 38 41 38 42 38 43 38 44 38 45 38 46 38 47
   ! set excl46 = 38 48 38 49 39 40 39 41 39 42 39 43 39 44 39 45 39 46 39 47 39 48
   ! set excl47 = 39 49 40 41 40 42 40 43 40 44 40 45 40 46 40 47 40 48 40 49 41 42
   ! set excl48 = 41 43 41 44 41 45 41 46 41 47 41 48 41 49 42 43 42 44 42 45 42 46
   ! set excl49 = 42 47 42 48 42 49 43 44 43 45 43 46 43 47 43 48 43 49 44 45 44 46
   ! set excl50 = 44 47 44 48 44 49 45 46 45 47 45 48 45 49 46 47 46 48 46 49 47 48
   ! set excl51 = 47 49 48 49
   ! excl @excl1 @excl2 @excl3 @excl4 @excl5 @excl6 @excl7 @excl8 @excl9 @excl10 @excl11 @excl12 @excl13 @excl14 @excl15 @excl16 @excl17 @excl18 @excl19 @excl20 @excl21 @excl22 @excl23 @excl24 @excl25 @excl26 @excl27 @excl28 @excl29 @excl30 @excl31 @excl32 @excl33 @excl34 @excl35 @excl36 @excl37 @excl38 @excl39 @excl40 @excl41 @excl42 @excl43 @excl44 @excl45 @excl46 @excl47 @excl48 @excl49 @excl50 @excl51
   set si = 1
   label ex_si_loop
   if @si .le. @nsites then
      set ii = 1
      label ex_ii_loop
      if @ii .le. @nsubs@@si then
         calc jj = @ii + 1
         label ex_jj_loop
         if @jj .le. @nsubs@@si then
            calc iip1 = @ii + 1
            calc jjp1 = @jj + 1
            adex @iip1 @jjp1
            calc jj = @jj + 1
            goto ex_jj_loop
         endif
         calc ii = @ii + 1
         goto ex_ii_loop
      endif
      calc si = @si + 1
      goto ex_si_loop
   endif

   !!rmla bond thet dihe impr 
   rmla bond thet impr 
   ! msld 0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  fnex @fnex
   msld 0  1  1  1  1  1  1  1  1  2  2  2  2  2  2  2  2  fnex @fnex
   msma

   thbv inde all auto

   scat on
   scat k 118.4
   cats select ( .bonded. atom @ligseg @resnum C001 ) .and. .not. -
               ( atom @ligseg @resnum C001 .or. -
               atom @ligseg @resnum H002 .or. -
               atom @ligseg @resnum C003 ) show end
   cats select ( .bonded. atom @ligseg @resnum C003 ) .and. .not. -
               ( atom @ligseg @resnum C003 .or. -
               atom @ligseg @resnum H004 .or. -
               atom @ligseg @resnum C001 ) show end

   ! Check block.doc for functional form of these biasing potentials
   calc nbiaspot = 5 * ( @nblocks * ( @nblocks - 1 ) ) / 2
   ldbi @nbiaspot
   set ibias = 1
   set iblock = 0
   set si = 1
   label loop5_vb
   if @si .le. @nsites then
      set jblock = @iblock
      set sj = @si
      label loop5b_vb
      if @sj .le. @nsites then
         set ii = 1
         label loop6_vb
         if @ii .le. @nsubs@@{si} then
            calc ip1 = @ii + 1 + @iblock
            set jj = 1
            if @si .eq. @sj then
               calc jj = @ii + 1
            endif
            label loop7_vb
            if @jj .le. @nsubs@@{sj} then
               calc jp1 = @jj + 1 + @jblock
   
               set c_shift = 0.0
               set x_shift = 0.0
               set s_shift = 0.0
               !vbrex! if @si .eq. @sj then
               !vbrex!    calc c_shift = 1.2 * (@myrep - @ncentral)
               !vbrex!    calc s_shift = 0.3 * (@myrep - @ncentral)
               !vbrex! endif
   
               calc coeff = @cs@@{si}s@@{ii}s@@{sj}s@@{jj} + @{c_shift}
               ldbv @ibias @ip1 @jp1 6 0.0 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @xs@@{si}s@@{ii}s@@{sj}s@@{jj} + @{x_shift}
               ldbv @ibias @ip1 @jp1 10 -5.56 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @ss@@{si}s@@{ii}s@@{sj}s@@{jj} + @{s_shift}
               ldbv @ibias @ip1 @jp1 8 0.017 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @xs@@{sj}s@@{jj}s@@{si}s@@{ii} + @{x_shift}
               ldbv @ibias @jp1 @ip1 10 -5.56 @coeff 0
               calc ibias = @ibias + 1
               calc coeff = @ss@@{sj}s@@{jj}s@@{si}s@@{ii} + @{s_shift}
               ldbv @ibias @jp1 @ip1 8 0.017 @coeff 0
               calc ibias = @ibias + 1
               calc jj = @jj + 1
               goto loop7_vb
            endif
            calc ii = @ii + 1
            goto loop6_vb
         endif
         calc jblock = @jblock + @nsubs@@{sj}
         calc sj = @sj + 1
         goto loop5b_vb
      endif
      calc iblock = @iblock + @nsubs@@{si}
      calc si = @si + 1
      goto loop5_vb
   endif
END

!! !! Set NOE distance restraints
!! NOE
!!    RESET
!! END
!! 
!! faster on
!! !! set up energy parameters if you want to use NOEs
!! nbonds atom fswitch vdw vfswitch cdie eps 1 -
!!     cutnb 14.0 cutim 14.0 ctonnb 10.0 ctofnb 12.0

!! energy
!! NOE
!! ! Site 1
!!    assign sele atom LIG 1 Atom1 end sele atom LIG 1 Atom2 end -
!!    kmin 1.0 rmin 0.0 kmax 1.0 rmax 0.2 fmax 2.0 rswitch 2.0 sexp 1.0
!! ! Site 2
!!    assign sele atom LIG 1 Atom1 end sele atom LIG 1 Atom2 end -
!!    kmin 1.0 rmin 0.0 kmax 1.0 rmax 0.2 fmax 2.0 rswitch 2.0 sexp 1.0
!! 
!!    print anal
!! END


